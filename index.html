<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modern Terminal</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      body {
        font-size: 16px;
      }

      .input-container {
        position: relative;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .controls {
        display: flex;
        gap: 5px;
      }

      .control-button {
        background-color: #232323;
        color: #fff;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 5px;
      }

      .control-button:hover {
        background-color: #333;
      }

      .input {
        background: none;
        border: none;
        color: #fff;
        font-family: "Proxima Nova", "Helvetica Neue", helvetica, arial,
          sans-serif;
        font-size: 16px;
        outline: none;
        margin: 0;
        padding: 0;
        display: inline;
        line-height: 1.5;
        width: 70%;
      }

      .input:focus {
        outline: none;
      }

      .prompt {
        color: #38597c;
      }

      .output {
        color: #32c146;
      }

      .error {
        color: red;
      }
      .ai {
        color: blue;
      }
      .ai-error {
        color: rgb(241, 150, 38);
      }
      .comment {
        opacity: 0.5;
      }

      .window {
        width: 80%;
        margin: 0 auto 2rem;
        box-shadow: 0 0.25rem 0.5rem #12181e;
        border-radius: 0 0 0.1rem 0.1rem;
      }

      .bar {
        background: #191919;
        height: 36px;
        border-radius: 0.5rem 0.5rem 0 0;
      }

      .btn::before,
      .btn::after,
      .btn {
        width: 12px;
        height: 12px;
        border-radius: 100%;
        display: block;
      }

      .btn {
        background: #f6b73e;
        position: relative;
        margin-left: 38px;
        top: 12px;
      }

      .btn::before,
      .btn::after {
        content: " ";
        position: absolute;
      }

      .btn::before {
        background: #f55551;
        margin-left: -20px;
      }

      .btn::after {
        background: #32c146;
        margin-left: 20px;
      }

      .body {
        background: #232323;
        padding: 18px;
        min-height: 100px; /* Minimum height to prevent collapse */
        height: auto; /* Allow height to adjust automatically */
        overflow-y: auto; /* Add vertical scrollbar if content exceeds height */
      }

      .body pre {
        margin: 0;
      }

      .transparent .prompt {
        opacity: 0.5; /* Adjust opacity as needed */
      }

      .title {
        color: #fff;
        font-size: 3rem; /* Increase title font size */
        text-align: center;
        text-transform: uppercase;
        margin-bottom: 0.5rem; /* Adjust margin as needed */
      }

      .subtitle {
        color: #ddd; /* Darker color for subtitle */
        font-size: 1.2rem; /* Adjust subtitle font size */
        text-align: center;
        margin-bottom: 2rem; /* Adjust margin as needed */
        font-style: italic; /* Italicize subtitle */
      }

      .body {
        /* background: #1a1818; */
        background: #181e25;
        padding: 18px;
        font-family: "Courier New", Courier, monospace; /* Monospace font for authenticity */
      }

      .output {
        color: #32c146;
        white-space: pre-wrap; /* Preserve whitespaces and line breaks */
      }
      .command-container {
        border: 1px solid #a9ff54; /* Bright border */
        background-color: rgba(16, 15, 15, 0.3); /* Light grey inner color */
        margin-bottom: 10px; /* Spacing between command containers */
        padding: 10px; /* Padding inside container */
        border-radius: 12px; /* Border radius */
      }
      .line-separator {
        margin: 10px 0; /* Adjust margin as needed */
        height: 1px; /* Height of the line */
        background-color: #4efff4; /* Blue color for the line */
        border: none; /* No border */
      }
    </style>
  </head>
  <body>
    <h1 class="title">COMET</h1>
    <p class="subtitle">Your AI Terminal</p>
    <div class="window">
      <div class="bar">
        <div class="btn"></div>
      </div>
      <div class="body">
        <pre>
                <div class="comment"># run this command:</div>
                <div class="output">$ hi</div>
            </pre>
      </div>
    </div>
    <footer>
      <!-- <img src="http://jamesduncombe.com/logo.svg" /> -->
    </footer>

    <script>
      const { ipcRenderer } = require("electron");

      window.onload = function () {
        appendInputContainer();
        //ipcRenderer.send("dummy","ls");
        // Listen for command output
        ipcRenderer.on("command-output", (event, output) => {
          appendOutput(output); // Use the existing function to append the output
          appendInputContainer();
        });
        ipcRenderer.on("command-error", (event, output) => {
          appendError(output); // Use the existing function to append the output
          appendInputContainer();
        });
        ipcRenderer.on("command-ai", (event, output) => {
          console.log("\n this is explaination ->>>"+output.explaination);
          appendAi(output.explaination);
          console.log("\nthis is output ->>>"+output.command); // Use the existing function to append the output
          appendInputContainer(output.command);
        });
        ipcRenderer.on("command-error-ai", (event, output) => {
          appendAiError(output); // Use the existing function to append the output
          appendInputContainer();
        });

      };

      function handleInput(event) {
        if (event.key === "Enter") {
          const inputText = event.target.value; // Get the input text
          ipcRenderer.send("run-command", inputText); // Send the input text to the main process
        }
      }

      function appendOutput(text) {
        const terminalBody = document.querySelector(".body");
        const outputDiv = document.createElement("div");
        outputDiv.classList.add("output");
        outputDiv.textContent = text;
        terminalBody.appendChild(outputDiv);
      }
      function appendError(text) {
        const terminalBody = document.querySelector(".body");
        const outputDiv = document.createElement("div");
        outputDiv.classList.add("error");
        outputDiv.textContent = text;
        terminalBody.appendChild(outputDiv);
      }
      function appendAi(text) {
        const terminalBody = document.querySelector(".body");
        const outputDiv = document.createElement("div");
        outputDiv.classList.add("ai");
        outputDiv.textContent = text;
        terminalBody.appendChild(outputDiv);
      }
      function appendAiError(text) {
        const terminalBody = document.querySelector(".body");
        const outputDiv = document.createElement("div");
        outputDiv.classList.add("ai-error");
        outputDiv.textContent = text;
        terminalBody.appendChild(outputDiv);
      }

      function appendInputContainer(defaultInput) {
        const terminalBody = document.querySelector(".body");
        const inputContainerDiv = document.createElement("div");
        inputContainerDiv.classList.add("input-container");
        inputContainerDiv.innerHTML = `
       <div class="prompt">$ <input type="text" value="${defaultInput !== undefined ? defaultInput : ''}" class="input command" onkeydown="handleInput(event)" placeholder="Type your command..."></div>
       <div class="controls">
           <button class="control-button" onclick="clickAI()">AI</button>
           <button class="control-button">Error</button>
           <button class="control-button">Help</button>
       </div>
   `;
        terminalBody.appendChild(inputContainerDiv);
        const newCommandInput = inputContainerDiv.querySelector(".command");
        newCommandInput.focus();

        const olderInputContainers = terminalBody.querySelectorAll(
          ".input-container:not(:last-child) .controls"
        );
        olderInputContainers.forEach((container) => {
          container.style.visibility = "hidden";
          const inputs = container.parentElement.querySelectorAll(".input");
          inputs.forEach((input) => {
              input.disabled = true;
          });
        });
        // Remove controls from previous input, if any
        const previousInputContainer = terminalBody.querySelector(
          ".input-container:nth-last-child(2)"
        );
        if (previousInputContainer) {
          const previousInputControls =
            previousInputContainer.querySelector(".controls");
          previousInputControls.remove();
        }
      }

      function clickAI() {
        const inputText = document.querySelector(".input.command").value;
       console.log("in Click ai",inputText);
        ipcRenderer.send("command-ai", inputText);
      }

      function clickAIError() {
        const inputText = document.querySelector(".input.command").value;
       console.log("in Click AI Error",inputText);
        ipcRenderer.send("command-ai", inputText);
      }
    </script>
  </body>
</html>
